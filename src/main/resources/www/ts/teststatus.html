<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<link rel="icon" type="image/png" href="assets/img/favicon.ico">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<title>CMS</title>

<meta
	content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'
	name='viewport' />
<meta name="viewport" content="width=device-width" />


<!-- Bootstrap core CSS     -->
<link href="assets/css/bootstrap.min.css" rel="stylesheet" />

<!-- Animation library for notifications   -->
<link href="assets/css/animate.min.css" rel="stylesheet" />

<!--  Light Bootstrap Table core CSS    -->
<link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet" />


<!--  CSS for Demo Purpose, don't include it in your project     -->
<link href="assets/css/demo.css" rel="stylesheet" />


<!--     Fonts and icons     -->
<link
	href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"
	rel="stylesheet">
<link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300'
	rel='stylesheet' type='text/css'>
<link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />


<link type="text/css" rel="stylesheet" href="stylesheets/style.css" />
<link type="text/css" rel="stylesheet"
	href="assets/css/jquery.tag-editor.css" />

</head>
<body>

	<div class="wrapper">
		<div class="sidebar" data-color="purple" data-image="back.jpg">

			<!--   you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple" -->


			<div class="sidebar-wrapper">
				<div class="logo">
					<a href="#" class="simple-text">Service Scripting</a>
				</div>
				<ul class="nav">
					<li>
						<table class="table" id="settings">
							<thead>
								<th>Settings</th>
								<th class="text-center"></th>
							</thead>
							<tbody>
							</tbody>
						</table>

					</li>


					<li class="active active-pro"><a href="index.html"> <i
							class="pe-7s-home"></i>
							<p>Home</p>
					</a></li>

				</ul>
			</div>
		</div>


		<div class="main-panel">

			<nav class="navbar navbar-default navbar-fixed">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse"
							data-target="#navigation-example-2">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>

						<ul>
							<li>shortcut key [Ctrl-Space] : AutoComplete</li>
						</ul>
					</div>
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-nav navbar-left">
							<li><a href="#" class="dropdown-toggle"
								data-toggle="dropdown"> <i class="fa fa-dashboard"></i>
							</a></li>



						</ul>
						<ul class="nav navbar-nav navbar-right">
							<li id="fstatus"></li>



						</ul>

					</div>
				</div>
			</nav>


			<div class="content">
				<div class="container-fluid">
					<div class="editor-area">
						<div class="warp-container">
							<div class="langauge-title" style="float: left;">
								<div style="float: left;">
									<h2 style="height: 20px; line-height: 20px">typescript</h2>
								</div>
								<div style="float: left; padding-top: 5px; padding-left: 20px">
									<!-- <select id="select-sample">
				<option selected="selected" value="ms.ts">MS</option>
              </select> -->
									<select id="select-extent"
										style="height: 26px; line-height: 26px; margin: 0px">
										<option selected="selected" value="Link">Link</option>
									</select> <input id="extentValue" class="form-control" value="" />
								</div>



								<div style="clear: both"></div>
							</div>
							<div class="editor-container">

								<div id="editor"></div>
							</div>
						</div>

						<div class="warp-container">
							<div class="langauge-title" style="float: right; width: 100%">

								<table class="row" style="width: 98%; float: right">
									<tr>
										<td class="col" style="width: 300px"><input
											id="parameters" value="" /></td>
										<td class="col" style="width: 100px">
											<div id="javascript-run">Run</div>
										</td>
									</tr>
								</table>



							</div>
							<div style="clear: both"></div>


							<div class="editor-container" style="float: right">
								<div id="output"></div>
							</div>
						</div>
					</div>






				</div>
			</div>

			<footer class="footer">
				<div class="container-fluid">
					<nav class="pull-left">
						<ul>

						</ul>
					</nav>

				</div>
			</footer>


		</div>
	</div>
</body>

<!--   Core JS Files   -->
<script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>

<!--  Charts Plugin -->
<script src="assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="assets/js/bootstrap-notify.js"></script>


<!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="assets/js/light-bootstrap-dashboard.js"></script>

<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
<script src="assets/js/demo.js"></script>


<script>
	$(document).ready(
			function() {

				var executionId = getUrlVars()["executionId"];

				var urlExec = $("#testCaseCloudURL").html()
						+ "executions/execution/" + executionId;

				$.getJSON(urlExec, function(data) {

					var context = data._source;

					$("#settings tbody").append(
							'<tr><td>EXECUTION ID</td><td>' + data._id
									+ '</td></tr>');

					for ( var k in context) {

						if (k == "context") {
							for ( var v in context[k]) {
								$("#settings tbody").append(
										'<tr><td>' + v.toUpperCase()
												+ '</td><td>' + context[k][v]
												+ '</td></tr>');
							}

						} else
							$("#settings tbody").append(
									'<tr><td>' + k.toUpperCase() + '</td><td>'
											+ context[k] + '</td></tr>');

					}

					loadResult(context.projectName);

				});

			});

	function loadResult(projectName) {

		var executionId = getUrlVars()["executionId"];

		var url = $("#testCaseCloudURL").html() + projectName
				+ "/testsummary?executionId=" + executionId;

		var pass = 0;
		var fail = 0;
		$
				.getJSON(
						url,
						function(data) {

							var recs = data.hits.hits;

							for ( var k in recs) {

								var rec = recs[k]._source;
								var message = "";
								if (rec.status == "SUCCESS") {
									pass++;
								} else {
									fail++;
									for ( var y in rec.steps) {

										message += (rec.steps)[y].errorMessage;
									}
								}

								var st = (rec.status == "SUCCESS") ? '<i class="pe-7s-check" style="color:green;font-size:2em"></i>SUCCESS'
										: '<i class="pe-7s-close-circle" style="color:red;font-size:2em"></i>FAILURE';

								var out = '<tr>' + '<td>' + (parseInt(k) + 1)
										+ '</td>' + '<td>' + rec.name + '</td>'
										+ '<td>' + rec.id + '</td>' + '<td>'
										+ st + '</td>' +

										'<td style="max-width:100px;word-wrap: break-word">'
										+ message + '</td>' + '</tr>'

								$("#testresult tbody").append(out);
							}

							var passp = (pass * 100 / (pass + fail)).toFixed(2);
							var failp = (fail * 100 / (pass + fail)).toFixed(2);

							$("#pass").html(pass + "( " + passp + "% )");

							$("#fail").html(fail + "( " + failp + "% )");

							if (fail == 0) {

								$("#fstatus")
										.append(
												'<i class="pe-7s-check" style="font-size:3em;color:green"></i>');
							} else {
								$("#fstatus")
										.append(
												'<i class="pe-7s-close-circle" style="font-size:3em;color:red"></i>');
							}

							var dataA = [
									(pass * 100 / (pass + fail)).toFixed(2),
									(fail * 100 / (pass + fail)).toFixed(2) ];

							var labelsA = [ passp + "%", failp + "%" ];

							createPiChart("#chartPreferences", labelsA, dataA);

							$("#statHeader p")
									.html(
											"<i class=\"fa fa-circle text-info\"></i>Pass : "
													+ pass
													+ "/"
													+ (pass + fail)
													+ "<br> <i class=\"fa fa-circle text-danger\"></i>Fail : "
													+ fail + "/"
													+ (pass + fail));

						});
	}

	function runTests(env) {

		execute(newArray, val, true, envInfo);

	}

	function execute(urlsToty, val, initStatus, envInfo) {
		var url = urlsToty.splice(0, 1)[0];
		send(
				"http://" + $(val).html() + url.url,
				function(status, data) {
					if (!status)
						$("td:nth-child(4)", $(val).parent()).append(
								url.failureReason + " : " + data);
					initStatus = initStatus && status;

					envInfo.status = envInfo.status && initStatus;
					if (envInfo.status) {
						$("#" + envInfo.id + "S").html(
								'<i class="fa fa-check text-success">');
					} else {
						$("#" + envInfo.id + "S").html(
								'<i class="fa fa-check text-danger">');
					}
					if (urlsToty.length > 0)
						execute(urlsToty, val, initStatus, envInfo);
					else {
						var st = (initStatus) ? '<i class="pe-7s-check" style="color:green;font-size:2em"></i>SUCCESS'
								: '<i class="pe-7s-close-circle" style="color:red;font-size:2em"></i>FAILURE';
						if (initStatus) {
							$("td:nth-child(3)", $(val).parent()).html(st);
						} else {
							$("td:nth-child(3)", $(val).parent()).html(st);
						}

					}
				});
	}

	function send(url, callBack) {

		$.ajax(url, {
			success : function(data) {
				callBack(true, data);
			},
			error : function(xhr) {
				callBack(false, xhr.responseText);
			}
		});
	}

	function createPiChart(id, labels, data) {

		var dataPreferences = {
			series : [ [ 25, 25, 25, 25 ] ]
		};

		var optionsPreferences = {
			donut : true,
			donutWidth : 40,
			startAngle : 0,
			total : 100,
			showLabel : false,
			axisX : {
				showGrid : false
			}
		};

		Chartist.Pie(id, dataPreferences, optionsPreferences);

		Chartist.Pie(id, {
			/* labels: ['62%','32%','6%'],
			series: [62, 32, 6] */
			labels : labels,
			series : data
		});
	}

	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
				function(m, key, value) {
					vars[key] = value;
				});
		return vars;
	}
</script>


</html>
